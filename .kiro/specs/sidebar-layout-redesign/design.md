# Design Document: Sidebar Layout Redesign

## Overview

æœ¬è®¾è®¡å°† Amigo åº”ç”¨ä»å•åˆ—å‚ç›´å¸ƒå±€é‡æ„ä¸ºç°ä»£åŒ–çš„ä¾§è¾¹æ å¸ƒå±€ã€‚æ–°å¸ƒå±€é‡‡ç”¨å·¦ä¾§å›ºå®šä¾§è¾¹æ  + å³ä¾§ä¸»å†…å®¹åŒºçš„ç»å…¸åŒæ ç»“æ„ï¼Œç±»ä¼¼äºè±†åŒ…ã€Gemini ç­‰ä¸»æµ AI èŠå¤©åº”ç”¨ã€‚

### è®¾è®¡ç›®æ ‡

1. æå‡å¯¼èˆªæ•ˆç‡ - ä¼šè¯å†å²å§‹ç»ˆå¯è§ï¼Œå¿«é€Ÿåˆ‡æ¢
2. ç°ä»£åŒ–è§†è§‰ - è¾“å…¥æ¡†é‡‡ç”¨åœ†è§’ã€é˜´å½±ç­‰ç°ä»£è®¾è®¡å…ƒç´ 
3. èˆ’é€‚çš„é˜…è¯»ä½“éªŒ - å¢åŠ åº•éƒ¨è¾¹è·ï¼Œå†…å®¹ä¸æ‹¥æŒ¤

## Architecture

### å¸ƒå±€ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        App Container                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Sidebar    â”‚              Main Content                     â”‚
â”‚   (260px)    â”‚                                               â”‚
â”‚              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚                                        â”‚  â”‚
â”‚ â”‚ New Chat â”‚ â”‚  â”‚           Chat Messages                â”‚  â”‚
â”‚ â”‚  Button  â”‚ â”‚  â”‚                                        â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚                                        â”‚  â”‚
â”‚              â”‚  â”‚                                        â”‚  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚                                        â”‚  â”‚
â”‚ â”‚ History  â”‚ â”‚  â”‚                                        â”‚  â”‚
â”‚ â”‚  List    â”‚ â”‚  â”‚                                        â”‚  â”‚
â”‚ â”‚          â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚ â”‚          â”‚ â”‚                                               â”‚
â”‚ â”‚          â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ â”‚          â”‚ â”‚  â”‚         Message Input Box              â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚  [ğŸ“] [è¾“å…¥æ¶ˆæ¯...]           [å‘é€]   â”‚  â”‚
â”‚              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç»„ä»¶å±‚æ¬¡

```
App
â”œâ”€â”€ Sidebar
â”‚   â”œâ”€â”€ NewChatButton
â”‚   â””â”€â”€ ConversationHistory
â””â”€â”€ MainContent
    â”œâ”€â”€ ChatWindow
    â””â”€â”€ MessageInput
```

## Components and Interfaces

### 1. Sidebar ç»„ä»¶

æ–°å»ºä¾§è¾¹æ å®¹å™¨ç»„ä»¶ï¼ŒåŒ…å«æ–°å»ºå¯¹è¯æŒ‰é’®å’Œä¼šè¯å†å²åˆ—è¡¨ã€‚

**æ ·å¼è§„èŒƒï¼š**
- å®½åº¦ï¼š260px å›ºå®š
- é«˜åº¦ï¼š100vh
- ä½ç½®ï¼šå·¦ä¾§å›ºå®š (position: fixed)
- èƒŒæ™¯ï¼š`--color-neutral-50` (#fafafa)
- è¾¹æ¡†ï¼šå³ä¾§ 1px `--color-neutral-200`
- å†…è¾¹è·ï¼š16px

### 2. NewChatButton ç»„ä»¶

æ–°å»ºå¯¹è¯æŒ‰é’®ï¼Œæ”¾ç½®åœ¨ä¾§è¾¹æ é¡¶éƒ¨ã€‚

**æ ·å¼è§„èŒƒï¼š**
- å®½åº¦ï¼š100%
- é«˜åº¦ï¼š44px
- åœ†è§’ï¼š`--radius-lg` (12px)
- èƒŒæ™¯ï¼š`--color-neutral-100`ï¼Œhover æ—¶ `--color-neutral-200`
- è¾¹æ¡†ï¼š1px dashed `--color-neutral-300`
- å›¾æ ‡ï¼šPlus å›¾æ ‡ + "æ–°å»ºå¯¹è¯" æ–‡å­—

### 3. MessageInput ç»„ä»¶æ”¹é€ 

é‡æ–°è®¾è®¡è¾“å…¥æ¡†æ ·å¼ï¼Œä½¿å…¶æ›´ç°ä»£åŒ–ã€‚

**æ ·å¼è§„èŒƒï¼š**
- åœ†è§’ï¼š`--radius-xl` (16px) æˆ–æ›´å¤§
- è¾¹æ¡†ï¼š1px `--color-neutral-200`
- é˜´å½±ï¼š`--shadow-sm`
- å†…è¾¹è·ï¼š16px
- æœ€å¤§å®½åº¦ï¼š800pxï¼Œå±…ä¸­æ˜¾ç¤º
- åº•éƒ¨è¾¹è·ï¼š24px

**è¾“å…¥æ¡†å†…éƒ¨å¸ƒå±€ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ğŸ“]  è¾“å…¥æ¶ˆæ¯æˆ–é€‰æ‹©æŠ€èƒ½...                    [ğŸ¤] [â†‘] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. Layout ç»„ä»¶

æ–°å»ºå¸ƒå±€å®¹å™¨ç»„ä»¶ï¼Œç®¡ç†æ•´ä½“é¡µé¢ç»“æ„ã€‚

```typescript
interface LayoutProps {
  children?: React.ReactNode;
}
```

## Data Models

### æ‰©å±• WebSocket Context

```typescript
// æ–°å¢æ–¹æ³•
interface WebSocketContextExtension {
  createNewConversation: () => void;  // åˆ›å»ºæ–°å¯¹è¯ï¼Œæ¸…ç©ºå½“å‰ä¼šè¯
}
```

## Correctness Properties

*A property is a characteristic or behavior that should hold true across all valid executions of a system-essentially, a formal statement about what the system should do. Properties serve as the bridge between human-readable specifications and machine-verifiable correctness guarantees.*

### Property 1: Sidebar width consistency

*For any* rendered state, the sidebar width SHALL always be exactly 260px.

**Validates: Requirements 1.2**

## Error Handling

### ç½‘ç»œé”™è¯¯

- åˆ›å»ºæ–°å¯¹è¯å¤±è´¥æ—¶ï¼Œæ˜¾ç¤º toast æç¤ºç”¨æˆ·é‡è¯•
- åˆ‡æ¢å¯¹è¯å¤±è´¥æ—¶ï¼Œä¿æŒå½“å‰å¯¹è¯çŠ¶æ€ä¸å˜

### çŠ¶æ€åŒæ­¥

- ä¾§è¾¹æ çŠ¶æ€ä¸ URL ä¿æŒåŒæ­¥ï¼ˆå¯é€‰ï¼‰
- ç§»åŠ¨ç«¯ä¾§è¾¹æ å…³é—­æ—¶ï¼Œæ¢å¤ä¸»å†…å®¹åŒºæ»šåŠ¨

## Testing Strategy

### å•å…ƒæµ‹è¯•

ä½¿ç”¨ Vitest è¿›è¡Œç»„ä»¶å•å…ƒæµ‹è¯•ï¼š

1. Sidebar ç»„ä»¶æ¸²æŸ“æµ‹è¯•
2. NewChatButton ç‚¹å‡»äº‹ä»¶æµ‹è¯•
3. MessageInput æ ·å¼éªŒè¯æµ‹è¯•
4. Layout å¸ƒå±€ç»“æ„æµ‹è¯•

### å±æ€§æµ‹è¯•

ä½¿ç”¨ fast-check è¿›è¡Œå±æ€§æµ‹è¯•ï¼š

1. **Property 1**: éªŒè¯ä¾§è¾¹æ å®½åº¦å§‹ç»ˆä¸º 260px

**æµ‹è¯•æ ‡æ³¨æ ¼å¼ï¼š**
```typescript
// **Feature: sidebar-layout-redesign, Property 1: Sidebar width consistency**
// **Validates: Requirements 1.2**
```

### è§†è§‰å›å½’æµ‹è¯•

- ä½¿ç”¨ Playwright æˆªå›¾å¯¹æ¯”å…³é”®é¡µé¢çŠ¶æ€
- éªŒè¯è¾“å…¥æ¡†åœ†è§’ã€é˜´å½±ç­‰æ ·å¼ç»†èŠ‚

